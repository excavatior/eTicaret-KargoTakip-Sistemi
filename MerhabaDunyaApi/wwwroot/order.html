<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Sipariş Detayı</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f5f5f5; margin: 0; padding: 0; }
        .container { max-width: 600px; margin: 50px auto; padding: 20px; background: white; 
                     border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h2 { color: #333; }
        p { color: #555; line-height: 1.5; }
        .btn { display: inline-block; margin: 10px 5px 0 0; padding: 10px 20px; 
               background: #28a745; color: white; text-decoration: none; border-radius: 4px; 
               border: none; cursor: pointer; transition: background 0.3s; }
        .btn:hover { background: #1e7e34; }
        /* Modal Styles */
        #offset-modal { display: none; position: fixed; top: 20%; left: 50%; 
                        transform: translateX(-50%); background: white; padding: 20px; 
                        border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); 
                        max-width: 300px; width: 80%; z-index: 1000; }
        #offset-modal h3 { margin-top: 0; color: #333; }
        #offset-modal label, #offset-modal input, #offset-modal p { display: block; width: 100%; margin-top: 10px; }
        #offset-modal input { padding: 5px; width: 60px; }
        #offset-modal .btn-close { background: #dc3545; }
        #offset-modal .btn-close:hover { background: #c82333; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Sipariş Detayı</h2>
        <p>Karbon Ayak İzi: <span id="co2-value">Yükleniyor...</span> kg CO₂</p>
        <button id="offset-btn" class="btn">Karbonu Dengele</button>
        <a href="index.html" class="btn">Ana Sayfaya Dön</a>
    </div>

    <div id="offset-modal">
        <h3>Karbon Offset</h3>
        <label for="offset-count">Ağaç Adeti:</label>
        <input type="number" id="offset-count" value="1" min="1" />
        <p id="offset-cost">Maliyet: 10 TL</p>
        <button id="offset-purchase" class="btn">Satın Al</button>
        <button id="offset-close" class="btn btn-close">Kapat</button>
    </div>

    <script>
        // CO2 değerini göster
        async function showCO2(orderId) {
            const resp = await fetch('/api/emission/calculate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ YakitTipi: 'Diesel', Mesafe: 150 })
            });
            const { emisyon } = await resp.json();
            document.getElementById('co2-value').textContent = emisyon.toFixed(2);
        }
        showCO2(1);

        // Modal interactions and local cost calculation
        const costPerTree = 10; // TL per tree
        const offsetBtn = document.getElementById('offset-btn');
        const offsetModal = document.getElementById('offset-modal');
        const offsetCount = document.getElementById('offset-count');
        const offsetCost = document.getElementById('offset-cost');
        const purchaseBtn = document.getElementById('offset-purchase');
        const closeBtn = document.getElementById('offset-close');

        offsetBtn.addEventListener('click', () => {
            offsetModal.style.display = 'block';
            updateCost();
        });

        offsetCount.addEventListener('input', () => {
            updateCost();
        });

        closeBtn.addEventListener('click', () => {
            offsetModal.style.display = 'none';
        });

        purchaseBtn.addEventListener('click', () => {
            // Redirect to TEMA donation page
            window.open('https://www.tema.org.tr/fidan-bagisi-secenekleri', '_blank');
        });

        function updateCost() {
            const adet = parseInt(offsetCount.value) || 0;
            const totalCost = adet * costPerTree;
            offsetCost.textContent = `Maliyet: ${totalCost} TL`;
        }
    </script>
</body>
</html>
